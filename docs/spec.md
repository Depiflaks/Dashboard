# Онлайн Dashboard

**Назначение:**  
Веб-приложение для визуализации статистики на основе загружаемых Excel-таблиц.  
Система позволяет администраторам загружать таблицы, создавать графики и управлять доступом, а директорам — просматривать доступные графики и исходные данные в наглядном виде.

---

## Роли пользователей

### Директор

- Основной потребитель аналитической информации.
- Имеет права **только на просмотр** графиков и исходных данных.
- Не может редактировать таблицы, графики и пользователей.

### Администратор

- Ответственный за настройку и администрирование системы.
- Может загружать таблицы, создавать графики, управлять пользователями и доступом к графикам.
- Полный доступ ко всем функциям приложения.

---

## Функциональные возможности

### Общий функционал (для всех ролей)

#### 1. Вход в систему

**Описание:**  
Пользователь вводит логин и пароль. Система проверяет учетные данные и определяет роль пользователя.  
**Результат:**  
Пользователь перенаправляется на свою главную страницу (в зависимости от роли).  

**Use case:**  

- **Actor:** Директор, Администратор  
- **Precondition:** Пользователь зарегистрирован и активен.  
- **Main flow:**  
  1. Ввести логин и пароль.  
  2. Система проверяет данные.  
  3. При успехе → переход на dashboard.  
- **Postcondition:** Пользователь авторизован в системе.  

---

#### 2. Выход из системы

**Описание:**  
Разлогинивание пользователя, завершение сессии.  

**Use case:**  

- **Actor:** Все пользователи  
- **Flow:** Нажатие кнопки "Выход" → уничтожение токена → редирект на страницу входа.  

---

#### 3. Просмотр доступных графиков

**Описание:**  
Пользователь видит список графиков, к которым у него есть доступ.  
Директор — только свои (назначенные администратором).  
Администратор — все графики системы.  

**Use case:**  

- **Actor:** Все пользователи  
- **Main flow:**  
  1. Открыть раздел “Графики”.  
  2. Система отображает список по таблице `charts_accesses`.  
  3. Пользователь выбирает график и открывает его детальный просмотр.  

**UI/UX ожидания:**  

- Фильтр по названию, типу или дате создания графика.  
- Возможность переключения между табличным и карточным отображением.  

---

#### 4. Просмотр исходных данных

**Описание:**  
Пользователь может открыть исходные данные таблицы, на основе которой построен график.  
Отображаются только те строки и столбцы, к которым он имеет доступ через соответствующий график.  

**Use case:**  

- **Actor:** Все пользователи  
- **Main flow:**  
  1. Открыть график.  
  2. Нажать “Посмотреть исходные данные”.  
  3. Система подгружает данные из таблицы `tables` → `table_columns`.  

---

### Функционал администратора

#### 1. Добавить пользователя

**Описание:**  
Администратор может создать нового пользователя с определённой ролью.  

**Use case:**  

- **Actor:** Администратор  
- **Flow:**  
  1. Открыть раздел “Пользователи”.  
  2. Нажать “Добавить пользователя”.  
  3. Заполнить форму (логин, пароль, роль).  
  4. Система создаёт запись в `users`.  

---

#### 2. Выдать пользователю права на просмотр графиков

**Описание:**  
Администратор может указать, какие графики доступны конкретному пользователю.  

**Use case:**  

- **Actor:** Администратор  
- **Flow:**  
  1. Открыть раздел “Доступы”.  
  2. Выбрать пользователя и график.  
  3. Система создаёт запись в `charts_accesses`.  

---

#### 3. Загрузить новую таблицу

**Описание:**  
Администратор загружает `.xlsx`-файл. Система парсит его и сохраняет данные.  

**Use case:**  

- **Actor:** Администратор  
- **Flow:**  
  1. Нажать “Загрузить таблицу”.  
  2. Выбрать файл.  
  3. Система создаёт запись в `tables` и определяет колонки (`table_columns`).  

---

#### 4. Создать график по данным таблицы

**Описание:**  
Администратор создаёт график, указывая таблицу, параметры и тип визуализации.  

**Use case:**  

- **Actor:** Администратор  
- **Flow:**  
  1. Выбрать таблицу.  
  2. Задать тип графика (line/bar/pie и т.п.).  
  3. Добавить метрики и фильтры.  
  4. Сохранить → создаётся запись в `charts`.  

---

#### 5. Редактирование графиков

**Описание:**  
Администратор может редактировать существующие графики, метрики и фильтры.  

##### 5.1. Добавить / изменить фильтры  

- Таблица `chart_filters`  
- Поля: `column_name`, `operator`, `value`  
- Пример:  
  - `region IN ['North', 'South']`  
  - `date BETWEEN 2025-01-01 AND 2025-02-01`

##### 5.2. Добавить / изменить метрики  

- Таблица `chart_metrics`  
- Поля: `column`, `aggregate_func`, `color`, `label`  
- Пример: `SUM(sales)` как метрика для оси Y.  

---

## Таблицы

1. **users**
   - id  
   - login  
   - password  
   - role (`admin` / `director`)  
   - created_at  
   - updated_at  
   - deleted_at  

2. **tables**
   - id  
   - uploaded_by → users.id  
   - file_path  
   - created_at  
   - deleted_at  

3. **table_columns**
   - id  
   - table_id → tables.id  
   - name  
   - type  

4. **charts**
   - id  
   - type  
   - table_id → tables.id  
   - name  
   - created_at  
   - updated_at  
   - deleted_at  

5. **chart_metrics**
   - id  
   - chart_id → charts.id  
   - column  
   - aggregate_func  
   - color  
   - label  

6. **chart_filters**
   - id  
   - chart_id → charts.id  
   - column_name  
   - operator  
   - value  

7. **charts_accesses**
   - id  
   - user_id → users.id  
   - chart_id → charts.id  
   - created_at  
   - deleted_at  

---

## Поток работы администратора (пример)

1. Загрузка таблицы → создаётся запись в `tables`.  
2. Определяются колонки → `table_columns`.  
3. Создаётся график → `charts`.  
4. Добавляются метрики и фильтры → `chart_metrics`, `chart_filters`.  
5. Настраиваются доступы → `charts_accesses`.  
6. Директор видит график на своём дашборде
